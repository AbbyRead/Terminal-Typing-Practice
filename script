#!/bin/bash

# Check if bat is installed
if ! command -v bat &> /dev/null; then
	echo "Error: 'bat' command not found."
	echo "Please install bat to use this script."
	echo "Visit https://github.com/sharkdp/bat for installation instructions."
	exit 1
fi

# Function to check if stdin is coming from a pipe
stdin_has_data() {
	! [ -t 0 ]
}

if [ -n "$1" ]; then
	input=$(cat "$1")
elif stdin_has_data; then
	input=$(cat)
else
	input=$(pbpaste)
fi

# Create a temp file for recoloring lines
tempfile=$(mktemp)

# Use bat to colorize and iterate line by line
echo "$input" | bat -pp --force-colorization --language=C | while IFS= read -r line; do
	# Show the original line
	echo -e "$line"

	# Prompt user for input
	read -r -p "" user_input < /dev/tty

	# Save user input to temp file and colorize
	echo "$user_input" > "$tempfile"
	bat -pp --force-colorization --language=C "$tempfile"
done

# Clean up
rm "$tempfile"
